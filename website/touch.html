<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="timeline/Touch.js"></script>
    <title>Touch test</title>
    <style>
        html,body {
            padding: 0px;
            margin: 0px;
            height: 100%;
            width: 100%;
            display: flex;
            flex-direction: column;
        }
        .panel {
            flex: 1;
            /* width: 100%;
            height: 100%; */
            background: gray;
        }
        .touchpanel {
            padding: 15px;
            flex: 0 0 30px;
            display: flex;
        }
        .notouch {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .action {
            display: inline-block;
            background: lightgrey;
            border: 1px solid black;
            border-radius: 5px;
            padding: 5px;
            margin-right: 15px;
        }
        .last-action {
            background: green;
        }
        .touchend {
            background: turquoise;
        }
        .touchmove { 
            background: yellow;
        }
        .circle {
            position: absolute;
            width: 25px;
            height: 25px;
            border: 1px solid black;
            border-radius: 100vw;
            background: gray;
        }
    </style>
</head>
<body>
    <div class='touchpanel'>
        <div id="touchstart" class="action">Touch Start</div>
        <div id="touchmove" class="action">Touch Move</div>
        <div id="touchend" class="action">Touch End</div>
        <div id="touchcancel" class="action">Touch Cancel</div>
        <div id="status"></div>
    </div>
    <div class='panel' id="area">
        
    </div>
    <script>
        function handleAction(name) {
            const selected = document.getElementsByClassName("last-action")
            for( let s of selected  ) {
                s.classList.remove("last-action")
            }
            const btn = document.getElementById(name)
            btn.classList.add("last-action")
            
        }
        function addHit(el, event, name ) {
            const circle = document.createElement("div")
            circle.classList.add("circle")
            if ( name == "touchend" ) {
                circle.classList.add(name)
            }
            el.appendChild(circle)
            circle.style.left = event.clientX + "px"
            circle.style.top = event.clientY + "px"
        }
        function reportStatus(e) {
            const status = document.getElementById("status")
            status.innerText = `target=${e.target} X,Y=(${e.clientX},${e.clientY})`
        }

        const area = document.getElementById("area")
        if ( isTouchAvailable() ) {
            area.style.backgroundColor = "blue";    
            area.addEventListener("touchstart", function(e) {
                reportStatus(encodeURIComponent)
                handleAction("touchstart")
                area.innerHTML = ""
            })
            area.addEventListener("touchmove", function(e) {
                reportStatus(e)
                handleAction("touchmove")
                addHit(area, e, "touchmove")
            })
            area.addEventListener("touchend", function(e) {
                reportStatus(e)
                handleAction("touchend")
                addHit(area, e, "touchend")
            })
            area.addEventListener("touchcancel", function(e) {
                reportStatus(e)
                handleAction("touchcancel")
            })
        } else {
            area.innerText = "No touch available"
            area.classList.add("notouch")

            if ( true ) {
                // allow in here to test with mouse.
                area.innerHTML = ""
                area.style.backgroundColor = "blue";
                area.addEventListener("mousedown", function(e) {
                    reportStatus(e)
                    handleAction("touchstart")
                    area.innerHTML = ""
                })
                area.addEventListener("mousemove", function(e) {
                    reportStatus(e)
                    handleAction("touchmove")
                    addHit(area, e, "touchmove")
                })
                area.addEventListener("mouseup", function(e) {
                    reportStatus(e)
                    handleAction("touchend")
                    addHit(area, e, "touchend")
                })
                area.addEventListener("mouseleave", function(e) {
                    reportStatus(e)
                    handleAction("touchcancel")
                })
            }
        }

    </Script>
</body>
</html>